{
  "id": "complex-001",
  "name": "Developer role with production guardrails",
  "description": "Complex policy combining allow and deny statements to give developers broad access while protecting production resources.",
  "source": "https://docs.openshift.com/rosa/rosa_architecture/rosa-sts-about-iam-resources.html",
  "policy": {
    "version": "v0",
    "statements": [
      {
        "sid": "AllowReadAllClusters",
        "effect": "Allow",
        "actions": [
          "rosa:DescribeCluster",
          "rosa:DescribeNodePool",
          "rosa:DescribeAccessEntry",
          "rosa:ListClusters",
          "rosa:ListNodePools",
          "rosa:ListAccessEntries",
          "rosa:ListTagsForResource"
        ],
        "resources": [
          "*"
        ]
      },
      {
        "sid": "AllowFullAccessToDevClusters",
        "effect": "Allow",
        "conditions": {
          "StringEquals": {
            "rosa:ResourceTag/Environment": [
              "development",
              "staging"
            ]
          }
        },
        "actions": [
          "rosa:*"
        ],
        "resources": [
          "*"
        ]
      },
      {
        "sid": "AllowCreateDevClusters",
        "effect": "Allow",
        "conditions": {
          "StringEquals": {
            "rosa:RequestTag/Owner": "${aws:username}"
          }
        },
        "actions": [
          "rosa:CreateCluster"
        ],
        "resources": [
          "*"
        ]
      },
      {
        "sid": "DenyProductionModifications",
        "effect": "Deny",
        "conditions": {
          "StringEquals": {
            "rosa:ResourceTag/Environment": "production"
          }
        },
        "actions": [
          "rosa:DeleteCluster",
          "rosa:DeleteNodePool",
          "rosa:UpdateClusterConfig",
          "rosa:UpdateClusterVersion",
          "rosa:UpdateNodePoolConfig",
          "rosa:UpdateNodePoolVersion",
          "rosa:CreateAccessEntry",
          "rosa:DeleteAccessEntry"
        ],
        "resources": [
          "*"
        ]
      },
      {
        "sid": "DenyTagTampering",
        "effect": "Deny",
        "conditions": {
          "ForAnyValue:StringEquals": {
            "rosa:TagKeys": [
              "Environment",
              "Owner"
            ]
          }
        },
        "actions": [
          "rosa:TagResource",
          "rosa:UntagResource"
        ],
        "resources": [
          "*"
        ]
      },
      {
        "sid": "DenyClusterAdminAccessEntry",
        "effect": "Deny",
        "conditions": {
          "ArnLike": {
            "rosa:policyArn": "arn:aws:rosa::aws:cluster-access-policy/ROSAClusterAdminPolicy"
          }
        },
        "actions": [
          "rosa:AssociateAccessPolicy"
        ],
        "resources": [
          "*"
        ]
      }
    ]
  },
  "testCases": [
    {
      "description": "Developer can describe any cluster including production",
      "request": {
        "action": "rosa:DescribeCluster",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/prod-cluster",
        "resourceTags": {
          "Environment": "production"
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Developer can delete dev cluster",
      "request": {
        "action": "rosa:DeleteCluster",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/dev-cluster",
        "resourceTags": {
          "Environment": "development"
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Developer cannot delete production cluster",
      "request": {
        "action": "rosa:DeleteCluster",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/prod-cluster",
        "resourceTags": {
          "Environment": "production"
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Developer can create cluster tagged as development",
      "principal": {
        "username": "alice"
      },
      "request": {
        "action": "rosa:CreateCluster",
        "resource": "*",
        "context": {
          "rosa:RequestTag/Environment": "development",
          "rosa:RequestTag/Owner": "alice"
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Developer cannot create cluster tagged as production",
      "principal": {
        "username": "alice"
      },
      "request": {
        "action": "rosa:CreateCluster",
        "resource": "*",
        "context": {
          "rosa:RequestTag/Environment": "production",
          "rosa:RequestTag/Owner": "alice"
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Developer cannot change Environment tag",
      "request": {
        "action": "rosa:TagResource",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/dev-cluster",
        "context": {
          "rosa:TagKeys": [
            "Environment"
          ]
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Developer cannot grant cluster admin access",
      "request": {
        "action": "rosa:AssociateAccessPolicy",
        "resource": "arn:aws:rosa:us-west-2:111122223333:access-entry/dev-cluster/role/dev",
        "context": {
          "rosa:policyArn": "arn:aws:rosa::aws:cluster-access-policy/ROSAClusterAdminPolicy"
        }
      },
      "expectedResult": "DENY"
    }
  ],
  "notes": "This demonstrates combining allow and deny statements. Explicit denies always win. The policy provides broad dev access while protecting production and preventing privilege escalation."
}
