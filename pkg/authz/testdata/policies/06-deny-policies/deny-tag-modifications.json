{
  "id": "deny-003",
  "name": "Deny modifications to protected tags",
  "description": "Policy that denies adding, changing, or removing specific protected tags (like Environment or Owner). Prevents circumventing tag-based access controls.",
  "source": "https://docs.openshift.com/rosa/rosa_architecture/rosa-sts-about-iam-resources.html",
  "policy": {
    "version": "v0",
    "statements": [
      {
        "sid": "DenyModifyProtectedTags",
        "effect": "Deny",
        "conditions": {
          "ForAnyValue:StringEquals": {
            "rosa:TagKeys": [
              "Environment",
              "Owner",
              "CostCenter"
            ]
          }
        },
        "actions": [
          "rosa:TagResource",
          "rosa:UntagResource"
        ],
        "resources": [
          "*"
        ]
      },
      {
        "sid": "DenyCreateWithWrongTags",
        "effect": "Deny",
        "conditions": {
          "Null": {
            "rosa:RequestTag/Environment": "true"
          }
        },
        "actions": [
          "rosa:CreateCluster"
        ],
        "resources": [
          "*"
        ]
      }
    ]
  },
  "testCases": [
    {
      "description": "Cannot remove Environment tag",
      "request": {
        "action": "rosa:UntagResource",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "rosa:TagKeys": [
            "Environment"
          ]
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Cannot change Owner tag",
      "request": {
        "action": "rosa:TagResource",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "rosa:TagKeys": [
            "Owner"
          ]
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Can add non-protected tags",
      "request": {
        "action": "rosa:TagResource",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "rosa:TagKeys": [
            "Description",
            "Team"
          ]
        }
      },
      "expectedResult": "NOT_EVALUATED"
    },
    {
      "description": "Cannot create cluster without Environment tag",
      "request": {
        "action": "rosa:CreateCluster",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/new-cluster",
        "context": {
          "rosa:RequestTag/Environment": null,
          "rosa:RequestTag/Name": "my-cluster"
        }
      },
      "expectedResult": "DENY"
    }
  ],
  "notes": "This is crucial for ABAC security. If users can modify tags, they can bypass tag-based access controls. Combine with required tag enforcement."
}
